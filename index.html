<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>ZIM - Code Creativity</title>
<script type="module">
import zim from "https://zimjs.org/cdn/016/zim";

new Frame(FIT, 430, 932, dark, darker, ready);
function ready() {
    const fragment = ` // shader code starts
        #define SS(a,b,c) smoothstep(a-b,a+b,c)
        #define T iTime
        #define R iResolution

        uniform vec3 u_color; // Color uniform for the shader

        void mainImage( out vec4 color, in vec2 coord ) {
            vec2 uv = coord/R.xy;
            float intensity = SS(.9,.15,1.0);  // Simplified intensity calculation
            color = vec4(u_color * intensity, 1.0);
        }
    `; // shader code ends

    const shader = new Shader(W, H, fragment, {iTime: 0, u_color: [0, 0, 0]}).center();
    const statusLabel = new Label("Orientation: 0°", 20, "courier", "white").addTo().pos(20, 20);

    function handleOrientation(event) {
        // Beta is the front-to-back tilt in degrees, where front is positive
        const beta = event.beta;
        // Normalize beta to range from 0 to 1
        const redIntensity = Math.abs(Math.sin(beta * Math.PI / 180)); // Convert beta to range from 0 to 1
        shader.uniforms.u_color = [redIntensity, 0, 0]; // Update the shader's color intensity based on beta
        statusLabel.text = `Orientation: β ${beta.toFixed(2)}°`; // Display the orientation
    }

    if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        // iOS 13+ requires permission for device orientation
        DeviceOrientationEvent.requestPermission().then(permissionState => {
            if (permissionState === 'granted') {
                window.addEventListener('deviceorientation', handleOrientation);
            } else {
                alert("Permission for orientation sensors denied");
            }
        }).catch(console.error);
    } else {
        // Automatically add event listener on non-iOS 13+ devices
        window.addEventListener('deviceorientation', handleOrientation);
    }
}
</script>
<meta name="viewport" content="width=device-width, user-scalable=no" />
</head>
<body></body>
</html>
